#### redis 的一些难点与选型

redis setnx 过期时间设置
1.业务上，不能影响业务，譬如一定时间内需要这种阻塞式设置
2.不能影响性能，不能有大量的 key 在同一时间失效，譬如说 以用户为标识的 key，到第二天凌晨 几亿的用户 key不能同时失效，影响性能
3.原子性操作：
setnx：需要 setnx 与 expire 两次操作，不是原子性的，两次操作过程中可能会有并发问题，由于pipline也不是原子性的，所以无法保证
set -nx -ex 是原子性的
4.最后是版本的考虑，
setnx 在 redis 2.6.12 版本后就被舍弃了，这对业务升级有隐患
5.key 的设计，也能提高性能，
1.有唯一标识，计划+uid，因为同一计划只会设置一次首刷位置的插入，所以 计划 ID+uid 在淘汰时间上随机范围就可以长一些
2.key 越长越好，因为 redis 底层是 hash 进行查找 key，因此时间和空间复杂度都是o(1)，越长hash 冲突概率越小，总体来看，效率越高
最终是选择了 set -nx -ex
